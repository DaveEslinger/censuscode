---
title: "SIC to NAIC pdf scraping"
author: "Dave Eslinger"
date: "9/1/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::optsic_chunk$set(echo = TRUE)
```

```{r}
library(pdftools)
library(tidyverse)
library(here)
```

## Intro

Create lookup table by scrapping data table from SIC to NAIC pdf

```{r define_pathsic_filenames}
pdf_file <- here("data",
                 "sic-publication-structure-and-comparable-naics-indexes-in-the-producer-price-index.pdf")

output_file <- here("data","sic_to_naic.csv")
```


```{r read_and_convert_pdf}
pdf_pages <- pdf_data(pdf_file)

new_table <- data.frame(matrix(vector(), 0, 4))

for(page_num in 2:length(pdf_pages)) {  # Skip the first title page
  this_table <- pdf_pages[[page_num]] %>%
    arrange(y, x) %>% 
    mutate(field = case_when(
      x < 87 ~ "sic_industry",
      x >= 87 & x < 135 ~ "sic_product",
      x >= 135 & x < 508 ~ "sic_title",
      x >= 508 ~ "naic_product"
    )) %>% 
    group_by(y, field) %>% 
    summarize(value = str_c(text, collapse = " ")) %>% 
    pivot_wider(names_from = "field", values_from = "value") %>% 
    filter(y != 36 & y != 764) %>%   # Drop the header and page number lines
    ungroup() %>% 
    select(-y)                       # and get rid of the y coordinate
  
  new_table <- rbind(new_table, this_table)
} 

```

Write out the new file

```{r write_output}

write_csv(new_table, file = output_file)

```

